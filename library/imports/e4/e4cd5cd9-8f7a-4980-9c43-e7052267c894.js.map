{
  "version": 3,
  "sources": [
    "unknown"
  ],
  "names": [],
  "mappings": "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",
  "file": "unknown",
  "sourcesContent": [
    "var ServerApi = require('ServerApi')\r\nvar ClientApi = require('ClientApi')\r\n\r\nvar appKey = 'ef157e0cad97efcbc7e7c2b48ef9444f'\r\nvar appSecret = 'f1fcb5aac3a2'\r\nvar defaultToken = 'haha'\r\nvar roomid = 500\r\n\r\nvar serverApi = new ServerApi(appKey, appSecret)\r\nvar dID = cc.sys.localStorage.nim_web_sdk_deviceId\r\nconsole.log('设备ID:', dID);\r\nvar teamName = 'defaultTeamName'\r\nvar teamID = 8197635\r\n\r\n//IO游戏所有的网络逻辑在这个模块实现\r\nvar _p = {\r\n    //链接服务器\r\n    connect: function (userName, sucCallback) {\r\n        this.userName = this.userName || userName\r\n        this.sucCallback = this.sucCallback || sucCallback\r\n        this.dealEvent()\r\n\r\n        var self = this\r\n        //先登录账号\r\n        this.nim = ClientApi.getNim(dID, defaultToken, function (data) {\r\n            console.log('账号登录成功', data);\r\n            self.loginData = data\r\n            //---------------再加群---------------\r\n            self.enterTeam(self.enterTeamCallback)\r\n        })\r\n\r\n\r\n    },\r\n\r\n    //成功进群的回调\r\n    enterTeamCallback: function (teamData) {\r\n        // console.log('成功进群', data);\r\n        var netData = {\r\n            userData: this.loginData,\r\n            teamData: teamData\r\n        }\r\n        this.sucCallback(netData)\r\n    },\r\n\r\n    //创建账号\r\n    createAccid: function (userName) {\r\n        var data = {\r\n            accid: dID,\r\n            name: userName,\r\n            token: defaultToken\r\n        }\r\n        var self = this\r\n        serverApi.createUserId(data, function (err, json) {\r\n            if (json.code == 200) {\r\n                console.log('账号创建成功：', json.info);\r\n                self.connect()\r\n            }\r\n        })\r\n    },\r\n\r\n    //进入群\r\n    enterTeam: function () {\r\n        var self = this\r\n        //查询群\r\n        var data = {\r\n            tids: [teamID],\r\n            ope: 0,\r\n        }\r\n        serverApi.queryGroup(data, function (err, data) {\r\n            if (data.code == 414) {//没有这个群\r\n                console.log('没有这个群,创建一个.');\r\n                var data = {\r\n                    tname: teamName,\r\n                    owner: dID,\r\n                    msg: 'rehkjerhkerhjkergjkh',\r\n                    magree: 0,\r\n                    joinmode: 0,\r\n                }\r\n                serverApi.createGroup(data, function (err, data) {\r\n                    if (data.code == 414) {\r\n                        console.log('群创建失败：' + data.desc);\r\n                    }else if (data.code == 200) {\r\n                        console.log('群创建成功：' + data.tid);\r\n                        teamID = data.tid\r\n                        self.enterTeam()\r\n                    }\r\n                })\r\n            }\r\n            else if (data.code == 200) {//有这个群\r\n                var info = data.tinfos[0]\r\n                console.log('有这个群：', info);\r\n                \r\n                if(info.owner == dID){//如果已经是群主了，就直接下一步\r\n                    self.enterTeamCallback(info)\r\n                }\r\n                else{//否则就加群\r\n                    var data = {\r\n                        tid: info.tid,\r\n                        owner: info.owner,\r\n                        members: [dID],\r\n                        msg: 'rehkjerhkerhjkergjkh',\r\n                        magree: 0,\r\n                        joinmode: 0,\r\n                    }\r\n                    serverApi.addIntoGroup(data, function (err, data) {\r\n                        if (data.code == 200) {\r\n                            console.log('加群加入');\r\n                            self.enterTeamCallback(info)\r\n                        }\r\n                        else{\r\n                            console.log('加群失败：', data);\r\n                        }\r\n                    })\r\n                }\r\n\r\n            }\r\n            \r\n        })\r\n    },\r\n\r\n\r\n\r\n    //发送游戏同步信息\r\n    sendMsg: function (msgData) {\r\n        var options = {\r\n            scene: 'team',\r\n            to: teamID,\r\n            content: msgData,\r\n            resend: false,\r\n            done: this.sendMsgDone,\r\n        }\r\n        this.nim.sendCustomMsg(options)\r\n    },\r\n\r\n    //发送消息完成\r\n    sendMsgDone: function (argument) {\r\n        //console.log('发送消息完成', argument);\r\n    },\r\n\r\n\r\n    //处理事件\r\n    dealEvent: function () {\r\n        //网络上面的302错误\r\n        cc.director.GlobalEvent.on('302NIMErr', function (data) {\r\n            console.log('没这个账号，重新注册一个');\r\n            this.createAccid(this.userName)\r\n        }, this)\r\n\r\n        //玩家登录事件\r\n        cc.director.GlobalEvent.on('Net_login', function (data) {\r\n            //发送同步消息\r\n            console.log('发送登录消息：', data);\r\n            this.sendMsg(data)\r\n        }, this)\r\n\r\n        //收到同步消息\r\n        cc.director.GlobalEvent.on('getNetMsg', function (data) {\r\n            //收到同步消息\r\n            console.log('收到同步消息', data);\r\n        }, this)\r\n    },\r\n}\r\n\r\nmodule.exports = _p\r\n"
  ]
}